#!/usr/bin/env perl
## Copyright Â© 2011 by Daniel Friesel <derf@finalrewind.org>
## License: WTFPL:
##   0. You just DO WHAT THE FUCK YOU WANT TO.
use strict;
use warnings;
use autodie;
use 5.010;

use App::Pstatus::Status::Cgit;
use App::Pstatus::Status::Freshmeat;
use App::Pstatus::Status::Ikiwiki;
use App::Pstatus::List::Cgit;
use App::Pstatus::Out::XHTML;
use Config::Tiny;
use File::BaseDir qw(config_files);

my $conf = load_config();

my $status_cgit = App::Pstatus::Status::Cgit->new(%{$conf->{status_cgit}});
my $status_fm   = App::Pstatus::Status::Freshmeat->new(%{$conf->{status_freshmeat}});
my $status_iki  = App::Pstatus::Status::Ikiwiki->new(%{$conf->{status_ikiwiki}});

sub load_config {
	my $conffile = config_files('pstatus/config');
	return Config::Tiny->read($conffile);
}

# check_cpan

# check_github

# check_debian

# check_gentoo

# check_arch

my $project = App::Pstatus::List::Cgit->get();

for my $p (keys %{$project}) {
	$project->{$p}->{git} = $status_cgit->check(name => $p);
	$project->{$p}->{freshmeat} = $status_fm->check(name => $p);
	$project->{$p}->{web} = $status_iki->check(name => $p);
}

App::Pstatus::Out::XHTML->write($project);

__END__

=head1 NAME

=head1 SYNOPSIS

=head1 DESCRIPTION

=head1 OPTIONS

=head1 EXIT STATUS

=head1 CONFIGURATION

=head1 DEPENDENCIES

=head1 BUGS AND LIMITATIONS

=head1 AUTHOR

Copyright (C) 2011 by Daniel Friesel E<lt>derf@finalrewind.orgE<gt>

=head1 LICENSE

  0. You just DO WHAT THE FUCK YOU WANT TO.
